/*

    Copyright Â© 2016-2017 Dominique Climent, Florian Dubath

    This file is part of Monnaie-Leman Wallet.

    Monnaie-Leman Wallet is free software: you can redistribute it and/or modify
    it under the terms of the GNU Affero General Public License as published by
    the Free Software Foundation, either version 3 of the License, or
    (at your option) any later version.

    Monnaie-Leman Wallet is distributed in the hope that it will be useful,
    but WITHOUT ANY WARRANTY; without even the implied warranty of
    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
    GNU General Public License for more details.

    You should have received a copy of the GNU General Public License
    along with Monnaie-Leman Wallet.  If not, see <http://www.gnu.org/licenses/>.

*/
#!/usr/local/bin/node-bench

var Promise = require("events").Promise;

var xml = require("posix").cat("test.xml").wait(),
  path = require("path"),
  sax = require("../lib/sax"),
  saxT = require("../lib/sax-trampoline"),
  
  parser = sax.parser(false, {trim:true}),
  parserT = saxT.parser(false, {trim:true}),
  
  sys = require("sys");


var count = exports.stepsPerLap = 500,
  l = xml.length,
  runs = 0;
exports.countPerLap = 1000;
exports.compare = {
  "switch" : function () {
    // sys.debug("switch runs: "+runs++);
    // for (var x = 0; x < l; x += 1000) {
    //   parser.write(xml.substr(x, 1000))
    // }
    // for (var i = 0; i < count; i ++) {
      parser.write(xml);
      parser.close();
    // }
    // done();
  },
  trampoline : function () {
    // sys.debug("trampoline runs: "+runs++);
    // for (var x = 0; x < l; x += 1000) {
    //   parserT.write(xml.substr(x, 1000))
    // }
    // for (var i = 0; i < count; i ++) {
      parserT.write(xml);
      parserT.close();
    // }
    // done();
  },
};

sys.debug("rock and roll...");
